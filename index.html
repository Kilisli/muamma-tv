<%
	chanel = "UCBgTP2LOFVPmq15W-RH-WXA" 'TRT1 kanal ID'si istediğiniz bir kanalın ID'si ile değiştirin
	apiKey = "AIzaSyBiGDn6FXr4qR0zh_UoZ4JFjWWReKXWfLQ" 'Google'dan aldığınız API kimliği
	
Public Function VeriAl(strGelen)
	Set objVeriAl = Server.CreateObject("Microsoft.XMLHTTP")
	objVeriAl.Open "GET" , strGelen, FALSE		
	objVeriAl.sEnd
	VeriAl = objVeriAl.Responsetext
	SET objVeriAl = Nothing
End Function

	strVeri = VeriAL("https://www.googleapis.com/youtube/v3/channels?part=contentDetails&id="& chanel &"&key="& apiKey)
	chid = split(strVeri, """")
	
if InStr(strVeri,"items") > 0 then

	videoAdres = VeriAL("https://www.googleapis.com/youtube/v3/search?part=snippet&channelId="& chid(31) &"&eventType=live&type=video&key="& apiKey)

if Request.QueryString("canlikontrol") = "true" then
	Response.Write(videoAdres)
response.end	
end if
	
	vid = split(videoAdres, """")
	if UBound(vid) > 22 then
		Uyari = "Yayın canlı!"
		VideoAdres = vid(41)
		'yenile değişkeni false yayın var artık yenilemesin
		Response.Write "<script type=""text/javascript"">yenile = false;</script>"
	else
	
		sonvideoAdres = VeriAL("https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId="& chid(43) &"&key="& apiKey)
		svid = split(sonvideoAdres, """")

		if UBound(svid) > 124 then
			Uyari = "Yayın yok son video oynatılıyor!"
			VideoAdres = svid(125)
		else
			Uyari = "Yayın yok ve son video alınamadı varsayılan video!"
			VideoAdres = "4yXJBAhn0Q4" 'Yayın yok ve son video alınamadı varsayılan video
			Response.Write "<script type=""text/javascript"">yenile = false;</script>"
		end if
		
	end if

else
	Uyari = "Youtube API Kotanız doldu https://console.developers.google.com adresinden kota durumunu kontrol edebilirsiniz"
	VideoAdres = "4yXJBAhn0Q4" 'Yayın yok kota doldu varsayılan video
end if


Response.Write "<div id=""uyari"">" & Uyari & "</div><br>"

'adres sonundaki ?autoplay=1 otomatik başlaması için istemiyorsanız kaldırın
Response.Write "<iframe id=""trt1"" width=""640"" height=""360"" src=""https://www.youtube.com/embed/" & VideoAdres & "?autoplay=1"" frameborder=""0"" allow=""accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"" allowfullscreen></iframe>"

'YayinKontrol functionu sayfa ilk yüklendiğinde 1 defa tetikleyelim
Response.Write "<script type=""text/javascript"">$(document).ready(function () { YayinKontrol(); });</script>"
%>
